Что это: journalctl - это утилита для запроса и отображения записей из журнала systemd. Systemd – это system and service manager, который сейчас используется в большинстве дистрибутивов Linux, включая Ubuntu.
Зачем нужен: journalctl предоставляет более структурированный и удобный способ работы с системными журналами, чем просто чтение текстовых файлов. Он позволяет фильтровать записи по времени, приоритету, сервису, идентификатору процесса (PID) и другим критериям.
Как использовать (для экзамена):
Просмотр всего журнала:
Просмотр всего журнала:
journalctl
(По умолчанию отображает все записи, начиная с самых старых. Используй стрелки вверх/вниз для навигации, q для выхода).
Просмотр последних записей (аналог tail -f):
journalctl -f
Фильтрация по времени:
journalctl --since "yesterday"
journalctl --until "today"
journalctl --since "2023-10-27 10:00:00"
Фильтрация по приоритету (уровню важности):
journalctl -p err  # Показать только сообщения об ошибках
journalctl -p warning # Показать предупреждения и ошибки
(Уровни приоритета: emerg, alert, crit, err, warning, notice, info, debug)
Фильтрация по сервису (systemd unit):
journalctl -u sshd.service  # Показать записи только для сервиса sshd
Фильтрация по PID:
journalctl _PID=1234  # Показать записи только для процесса с PID 1234
Комбинирование фильтров:
journalctl -u sshd.service --since "yesterday" -p err
(Показать сообщения об ошибках от сервиса sshd за вчерашний день)
Показать сообщения ядра:
journalctl -k
Персистентность журнала (важно!):
По умолчанию журнал systemd хранится в оперативной памяти (в /run/log/journal). Это означает, что после перезагрузки системы журнал будет очищен.
Чтобы сделать журнал персистентным (сохранялся после перезагрузки), нужно создать каталог /var/log/journal:
sudo mkdir -p /var/log/journal
sudo systemd-tmpfiles --create --prefix /var/log/journal
sudo systemctl restart systemd-journald
Теперь журнал будет храниться на диске.




 auditd (Linux Audit System)
Что это: auditd – это подсистема аудита ядра Linux. Она позволяет отслеживать действия пользователей, системные вызовы и изменения файлов. Это мощный инструмент для безопасности и соответствия требованиям.
Зачем нужен: auditd предоставляет гораздо более детальную информацию о системных событиях, чем стандартные журналы. Он может отслеживать, кто, когда и как получил доступ к определенным файлам, какие команды выполнялись и какие системные вызовы были сделаны.
Как использовать (для экзамена):
Установка:
sudo apt-get install auditd
Запуск/остановка/перезапуск:
sudo systemctl start auditd
sudo systemctl stop auditd
sudo systemctl restart auditd
sudo systemctl status auditd # Проверить статус
Конфигурация:
Основной файл конфигурации: /etc/audit/auditd.conf (определяет параметры аудита, такие как размер журналов, количество хранимых файлов и т.д.)
Правила аудита: /etc/audit/rules.d/audit.rules (определяют, какие события отслеживать). Это самый важный файл для настройки.
auditctl – утилита для управления правилами аудита:
sudo auditctl -l: Показать текущие правила аудита.
sudo auditctl -D: Удалить все правила (будь осторожен!).
Примеры правил аудита (добавь их в /etc/audit/rules.d/audit.rules):
Отслеживание доступа к файлу:
-w /etc/passwd -p wa -k passwd_changes
( -w: Указывет файл или каталог для мониторинга. -p: Указывает права доступа для мониторинга (r - чтение, w - запись, x - выполнение, a - изменение атрибутов). wa означает запись и изменение атрибутов. -k: Добавляет ключ для облегчения поиска событий в журнале.)
Отслеживание выполнения команды:
-a always,exit -F arch=b64 -C auid!=4294967295 -C uid>=1000 -S execve -k user_commands
(-a: определяет действие которое следует выполнить при выполнении правила, always,exit означает всегда записывать информацию о выходе из системного вызова. -F: указывает фильтр, в данном случае -F arch=b64 означает, что правило применяется только к 64-битным архитектурам. -C: добавляет дополнительное условие фильтрации, auid!=4294967295 означает, что аудит не применяется к пользователям, у которых нет установленного идентификатора аудита (auid). uid>=1000 - пользователи с UID >= 1000. -S: определяет системный вызов, который нужно отслеживать, в данном случае execve (выполнение программы). -k: Добавляет ключ user_commands. )
Перезагрузка правил аудита:
sudo auditctl -R /etc/audit/rules.d/audit.rules
Или перезапуск сервиса auditd.

Поиск событий в журнале:
sudo ausearch -k passwd_changes  # Поиск событий, связанных с изменениями /etc/passwd
sudo ausearch -u <username> # Поиск событий, связанных с пользователем
sudo ausearch -sc execve # Поиск событий, связанных с выполнением команд
ausearch - утилита для поиска в журнале аудита.

Просмотр необработанных событий аудита:
sudo aureport -x
aureport - утилита для создания отчетов из журнала аудита.
